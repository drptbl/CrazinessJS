<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Diablo 3</title>

    <link href="./css/bootstrap.css" rel="stylesheet">
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.10/themes/ui-darkness/jquery-ui.css" rel="stylesheet">

    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      canvas{
        outline: 1px solid #000;
        margin: 20px 0px 40px 0px;
        overflow: hidden;
        -webkit-transform:rotate(180deg);
        -moz-transform:rotate(180deg);
      }
    </style>
    <script src="http://127.0.0.1:3000/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.10/jquery-ui.min.js"></script>

	<script>
	  var socket = io.connect('http://127.0.0.1');
	</script>

  </head>

  <body>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="nav-header">Actions</li>
              <li><a href="/">Home</a></li>
              <li><a href="player.html">Player</a></li>
              <li class="active"><a href="minimap.html">Minimap</a></li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <div class="span9">
          <div class="">
            <table class="info table table-striped">
              <thead>
                <tr>
                  <th>GUID</th>
                  <th>NAME</th>
                  <th>X</th>
                  <th>Y</th>
                  <th>Z</th>
                  <th>unknown</th>
                  <th>unknown</th>
                  <th>unknown</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="guid">&nbsp;</td>
                  <td class="name">&nbsp;</td>
                  <td class="posx">&nbsp;</td>
                  <td class="poxy">&nbsp;</td>
                  <td class="posz">&nbsp;</td>
                  <td class="unk1">&nbsp;</td>
                  <td class="unk2">&nbsp;</td>
                  <td class="unk3">&nbsp;</td>
                </tr>
              </tbody>
            </table>
            <div id="container"></div>
            <div id="canvasInfo"></div>
          </div>
        </div><!--/span-->
      </div><!--/row-->

      <hr>

      <footer>
        <p>&copy; BugCraft 2012</p>
      </footer>

    </div>

    <script src="./js/bootstrap.js"></script>
    <script src="http://www.html5canvastutorials.com/libraries/kinetic-v3.10.0.js"></script>

    <script>
    /**/
    window.onload = function() {
        var stage = new Kinetic.Stage({
          container: "container",
          width: (500),
          height: (500)
        });

        socket.on("RACtorsList",function(data){
          console.log("Here we are")
          var list = getRACtors(data)
          stage.clear()
          stage.add(list)

          list = null
        })
      };
    function getRACtors(data){
        var layer = new Kinetic.Layer();
        var maxWidth = 0
        var maxHeight = 0
        for (var i = data.RACtorsList.length - 1; i >= 0; i--) {

          if(maxWidth <= data.RACtorsList[i][3]){
            maxWidth = Math.ceil(data.RACtorsList[i][3])
          }
          if(maxHeight <= data.RACtorsList[i][4]){
            maxHeight = Math.ceil(data.RACtorsList[i][4])
          }
        
        };
        var x = maxWidth / 2
        var y = maxHeight / 2
        var info
        for (var i = data.RACtorsList.length - 1; i >= 0; i--) {
          if(data.RACtorsList[i][1] == "2008809472"){
            var color = "blue"
            var radius = 8
          }else if(data.RACtorsList[i][1] == -1){
            var color = "red"
            var radius = 2
          }else{
            var color = "green"
            var radius = 4
          }

          var circle = new Kinetic.Circle({
            x: Math.ceil(data.RACtorsList[i][4]),
            y: Math.ceil(data.RACtorsList[i][5]),
            radius: radius,
            fill: color,
            stroke: "black",
            strokeWidth: 1,
            draggable:true
          })

          circle.on('mouseover',(function(actor){
              return function(){
                 $(".info .guid").html(actor[1])
                 $(".info .name").html(actor[3])
                 $(".info .posx").html(actor[4])
                 $(".info .poxy").html(actor[5])
                 $(".info .posz").html(actor[6])
                 $(".info .unk1").html(actor[7])
                 $(".info .unk2").html(actor[8])
                 $(".info .unk3").html(actor[9])
              }
          }(data.RACtorsList[i])))

          circle.on('mouseout',function(){

          })

          circle.on('click',(function(actor){
              return function(){
                if(actor[1] != -1){
                  socket.emit('changeCamera',{id: actor[1]})
                }
              }
          }(data.RACtorsList[i])))

          layer.add(circle);
        }
        data = null
        return layer;
    }
    socket.emit('getRACtors')
    //setInterval("socket.emit('getRACtors')",2000);
	</script>
  </body>
</html>
